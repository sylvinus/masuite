# Configuration

All configuration lives in the `.env` file at the project root, generated by `./masuite setup`. This file is `.gitignore`d since it contains secrets.

## Key variables

### Core

| Variable | Example | Description |
|----------|---------|-------------|
| `COMPOSE_PROFILES` | `docs,meet,drive` | Which apps to start |
| `MASUITE_MODE` | `local` or `prod` | Deployment mode |
| `BASE_DOMAIN` | `suite.example.com` | Domain (prod mode) |

### Authentication

| Variable | Description |
|----------|-------------|
| `KEYCLOAK_URL` | External Keycloak URL |
| `KEYCLOAK_ADMIN_USER` | Admin username (default: `admin`) |
| `KEYCLOAK_ADMIN_PASSWORD` | Admin password (generated) |
| `SHARED_OIDC_CLIENT_SECRET` | Shared OIDC client secret for all apps |

All apps use a single Keycloak client (`masuite`) with one shared secret.

### Database

| Variable | Description |
|----------|-------------|
| `POSTGRES_ADMIN_PASSWORD` | PostgreSQL superuser password |
| `SHARED_DB_USER` | Shared database user for all apps |
| `SHARED_DB_PASSWORD` | Shared database password |
| `<APP>_DB_NAME` | Database name per app (e.g. `docs_db`) |

All apps share a single PostgreSQL user (`masuite_app`) with per-app databases.

### Object storage (RustFS)

| Variable | Description |
|----------|-------------|
| `RUSTFS_ACCESS_KEY` | RustFS admin access key |
| `RUSTFS_SECRET_KEY` | RustFS admin secret key |

Each app uses a dedicated S3 bucket (e.g. `docs-storage`, `drive-storage`) with the shared RustFS credentials.

### App-specific

| Variable | Description |
|----------|-------------|
| `<APP>_SECRET_KEY` | Django/app secret key |
| `LIVEKIT_API_KEY` | LiveKit API key (Meet) |
| `LIVEKIT_API_SECRET` | LiveKit API secret (Meet) |
| `LIVEKIT_URL` | LiveKit WebSocket URL |
| `DRIVE_EDITOR` | `collabora` or `onlyoffice` |
| `CONVERSATIONS_LLM_BACKEND` | OpenAI-compatible API URL |
| `CONVERSATIONS_LLM_API_KEY` | LLM API key |
| `CONVERSATIONS_LLM_MODEL` | Model name |
| `MESSAGES_MAIL_DOMAIN` | Email domain |
| `MESSAGES_SMTP_RELAY_HOST` | SMTP relay (or empty for direct) |
| `CALENDARS_CALDAV_INBOUND_API_KEY` | CalDAV inbound API key |
| `CALENDARS_CALDAV_OUTBOUND_API_KEY` | CalDAV outbound API key |

### Backup

| Variable | Default | Description |
|----------|---------|-------------|
| `BACKUP_RETENTION_DAILY` | `7` | Days to keep daily backups |
| `BACKUP_RETENTION_WEEKLY` | `4` | Weeks to keep weekly backups |
| `BACKUP_CRON` | `0 3 * * *` | Backup schedule |

## Image versions

Pinned versions are in `versions.env`:

```
DOCS_VERSION=v4.5.0
MEET_VERSION=v1.6.0
DRIVE_VERSION=v0.13.0
MESSAGES_VERSION=main
PROJECTS_VERSION=1.27.3
CONVERSATIONS_VERSION=v0.0.13
CALENDARS_VERSION=main
```

To pin a different version, override in `.env`:

```
DOCS_VERSION=v4.6.0
```

## Subdomains (prod mode)

| App           | Subdomain |
|---------------|-----------|
| Homepage      | (root)    |
| Docs          | `docs.`   |
| Meet          | `meet.`   |
| Drive         | `drive.`  |
| Messages      | `mail.`   |
| Projects      | `projects.` |
| Conversations | `chat.`   |
| Calendars     | `cal.`    |
| Keycloak      | `auth.`   |
| LiveKit       | `livekit.` |

All subdomains are under `BASE_DOMAIN`. DNS should have a wildcard A record: `*.suite.example.com -> server IP`.
